import { Meta, Title } from "@storybook/addon-docs/blocks";

<Meta title="Workspaces/App/Guide/Architecture" />

<Title>ğŸ—ï¸ Architecture</Title>

## Architecture Diagram

The following diagram illustrates the complete application flow from bootstrap to runtime architecture:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    @windows98/app                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                Bootstrap Process                       â”‚  â”‚
â”‚  â”‚ main.tsx â†’ bootstrap-app.tsx â†’ MainContainer â†’ Views   â”‚  â”‚
â”‚  â”‚    â”‚            â”‚                  â”‚           â”‚       â”‚  â”‚
â”‚  â”‚ Load CSS    Create React       Init App      Render    â”‚  â”‚
â”‚  â”‚ Call boot   Root + i18n        Config       Desktop    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚                                â”‚
â”‚                             â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Application   â”‚  â”‚ Infrastructure  â”‚  â”‚ Presentation â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚              â”‚  â”‚
â”‚  â”‚ â€¢ Hooks         â”‚  â”‚ â€¢ Configs       â”‚  â”‚ â€¢ Components â”‚  â”‚
â”‚  â”‚ â€¢ Portals       â”‚  â”‚ â€¢ Services      â”‚  â”‚ â€¢ Containers â”‚  â”‚
â”‚  â”‚ â€¢ Business      â”‚  â”‚ â€¢ Types         â”‚  â”‚ â€¢ Layouts    â”‚  â”‚
â”‚  â”‚   Logic         â”‚  â”‚ â€¢ External      â”‚  â”‚ â€¢ Views      â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚   Integration   â”‚  â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚                    â”‚
           â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ @windows98/      â”‚  â”‚ @windows98/      â”‚  â”‚ @windows98/      â”‚
â”‚ micro-services   â”‚  â”‚ micro-frontends  â”‚  â”‚ design-system    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ App Config     â”‚  â”‚ â€¢ Calculator     â”‚  â”‚ â€¢ Components     â”‚
â”‚ â€¢ App Controller â”‚  â”‚ â€¢ Notepad        â”‚  â”‚ â€¢ Styles         â”‚
â”‚ â€¢ Browser Env    â”‚  â”‚ â€¢ Start Menu     â”‚  â”‚ â€¢ Themes         â”‚
â”‚ â€¢ Date/Time      â”‚  â”‚ â€¢ Navigation     â”‚  â”‚ â€¢ Icons          â”‚
â”‚ â€¢ Error Handler  â”‚  â”‚ â€¢ Clock          â”‚  â”‚ â€¢ Typography     â”‚
â”‚ â€¢ Event Bus      â”‚  â”‚ â€¢ Settings       â”‚  â”‚ â€¢ Layout System  â”‚
â”‚ â€¢ File Manager   â”‚  â”‚ â€¢ Games          â”‚  â”‚                  â”‚
â”‚ â€¢ Language       â”‚  â”‚ â€¢ And more...    â”‚  â”‚                  â”‚
â”‚ â€¢ Storage        â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚ â€¢ Theme          â”‚  â”‚                  â”‚  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Bootstrap Process

The Windows98 app follows a structured initialization sequence that sets up the entire application environment:

### Phase 1: Entry Point (`main.tsx`)
```tsx
import "@windows98/design-system/index.css"
import { bootstrapApp } from "./bootstrap-app"

bootstrapApp()
```
- **Loads Design System**: Imports global CSS styles from `@windows98/design-system`
- **Initiates Bootstrap**: Calls the main bootstrap function to start the application

### Phase 2: React Setup (`bootstrap-app.tsx`)
```tsx
export async function bootstrapApp() {
  const root: Maybe<HTMLElement> = document.getElementById("root")
  
  ReactDOM.createRoot(root).render(
    <I18nextProvider i18n={i18n}>
      <MainContainer />
    </I18nextProvider>
  )
}
```
- **Creates React Root**: Establishes the React application root element
- **Sets up i18n**: Wraps the app with internationalization provider
- **Renders Main Container**: Mounts the primary application component

### Phase 3: Main Container (`MainContainer`)
```tsx
export const MainContainer: FunctionComponent = () => {
  useMainContainer() // Initializes app configuration and hooks
  
  return (
    <>
      <HomeView />
      <ProgramsPortal />
    </>
  )
}
```
- **Initializes Configuration**: Runs `useMainContainer` hook to set up app state
- **Renders Core Views**: Displays the desktop environment and program portal

### Phase 4: View Rendering
- **HomeView**: Renders the main desktop interface with taskbar and desktop icons
- **ProgramsPortal**: Manages dynamic loading and rendering of running applications
- **Application State**: All hooks and services are now active and managing application state

## Layers Overview

### Application Layer (`src/application/`)
- **Hooks**: Business logic and state management hooks
  - `useInitAppConfig` - Application configuration initialization
  - `useProgramManager` - Program lifecycle management
  - `useAppConfig`, `useLanguageManager`, `useThemeManager` - Service hooks
- **Portals**: Dynamic component rendering system
  - `ProgramsPortal` - Lazy-loads and renders running programs (Calculator, Notepad, Settings, etc.)

### Infrastructure Layer (`src/infrastructure/`)
- **Configs**: Application configuration files
  - `start-menu.config.ts` - Start menu structure and program definitions
- **Services**: External integrations and utilities
  - App, Browser, File Manager, Language, Program, Storage, Theme services
- **Types**: TypeScript type definitions and interfaces

### Presentation Layer (`src/presentation/`)
- **Components**: Reusable UI components wrapping micro-frontends
  - AudioButton, Calculator, Clock, Navigation, Notepad, Settings, etc.
- **Containers**: High-level component orchestrators
  - `MainContainer` - Root application container
- **Layouts**: Page layout components
  - `PulpitLayout` - Desktop background and icons
  - `NavigationLayout` - Taskbar and navigation elements
- **Views**: Complete page views
  - `HomeView` - Main desktop view combining layouts
