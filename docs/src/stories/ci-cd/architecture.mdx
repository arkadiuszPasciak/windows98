import { Meta, Title } from "@storybook/addon-docs/blocks";

<Meta title="CI-CD/Architecture" />

<Title>ğŸ—ï¸ Architecture</Title>

The CI/CD workspace implements a command orchestration architecture that efficiently manages automation tasks across the entire Windows98 monorepo through centralized command execution and selective workspace targeting.

## Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                @windows98/ci-cd                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚    Commands     â”‚  â”‚     Configs     â”‚                   â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚                   â”‚
â”‚  â”‚ â€¢ run.command   â”‚  â”‚ â€¢ ci-cd.config  â”‚                   â”‚
â”‚  â”‚   Entry Point   â”‚  â”‚   Workspace     â”‚                   â”‚
â”‚  â”‚                 â”‚  â”‚   Definitions   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Command Execution                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  build           â†’ @windows98/app                           â”‚
â”‚  lint:code:run   â†’ app, configs, design-system, docs...     â”‚
â”‚  lint:staged:fix â†’ app, configs, design-system, docs...     â”‚
â”‚  lint:styles:run â†’ app, design-system, micro-frontends      â”‚
â”‚  lint:types:run  â†’ app, design-system, docs, i18n...        â”‚
â”‚  test:ui:run     â†’ design-system, micro-frontends           â”‚
â”‚  test:unit:run   â†’ app, design-system, micro-frontends...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Structure

### **Commands Layer** (`src/commands/`)
- **`run.command.mjs`** - Entry point for all CI/CD operations
- Extracts command arguments from CLI
- Instantiates and executes CICDCommand class

### **Configuration Layer** (`src/configs/`)
- **`ci-cd.config.mjs`** - Central configuration defining workspace mappings
- Contains CICDCommand class with command execution logic
- Maps each command type to relevant workspace packages

## Execution Flow

### **Command Input**
- Developer runs `pnpm [command]` from CI/CD workspace
### **Argument Parsing**
- `run.command.mjs` extracts command type from CLI args
### **Configuration Lookup**
- CICDCommand retrieves workspace list for command
### **Sequential Execution**
- Commands run across each target workspace using PNPM filters
### **Error Handling**
- Robust error reporting with command and workspace context
### **Completion**
- Success/failure feedback with detailed logging

## Workspace Targeting Strategy

Each command type targets only relevant workspaces to optimize performance and avoid unnecessary operations:

### **Build Operations**
- `build` â†’ Only packages that produce deployable artifacts

### **Code Quality Operations**
- `lint:code:run` â†’ All packages with TypeScript/JavaScript code
- `lint:staged:fix` â†’ All packages for pre-commit hooks
- `lint:styles:run` â†’ Only packages with CSS/styling
- `lint:types:run` â†’ All packages with TypeScript definitions

### **Testing Operations**
- `test:ui:run` â†’ Only packages with UI components requiring browser testing
- `test:unit:run` â†’ All packages with testable business logic

## Performance Optimizations

- **Selective Targeting**: Commands only run on relevant workspaces
- **PNPM Integration**: Leverages PNPM's workspace filtering for efficient execution
- **Error Isolation**: Failed commands in one workspace don't block others
- **Sequential Processing**: Controlled execution prevents resource conflicts
