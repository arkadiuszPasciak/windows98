import { Meta, Title } from "@storybook/addon-docs/blocks";

<Meta title="CI-CD/Configuration" />

<Title>ðŸ”§ Configuration</Title>

The CI/CD workspace uses a centralized configuration system to manage command definitions and workspace targeting. Understanding the configuration structure enables customization and extension of the automation system.

## Configuration Files

### **`ci-cd.config.mjs`**
The main configuration file containing the CICDCommand class and workspace mappings.

**Location:** `src/configs/ci-cd.config.mjs`  
**Purpose:** Central command definitions and execution logic

### **`run.command.mjs`**
Entry point script that processes command-line arguments and initiates execution.

**Location:** `src/commands/run.command.mjs`  
**Purpose:** CLI interface and command bootstrapping

## Command Configuration Structure

The configuration uses a simple object mapping structure:

```javascript
#commands = {
  "command-name": [
    "@windows98/workspace1",
    "@windows98/workspace2",
    // ... additional workspaces
  ]
}
```

## Adding New Commands

To add a new command to the CI/CD system:

1. **Add Command Mapping** in `ci-cd.config.mjs`:
```javascript
#commands = {
  // ... existing commands
  "new:command": [
    "@windows98/target-workspace1",
    "@windows98/target-workspace2"
  ]
}
```

2. **Add Package Script** in `package.json`:
```json
{
  "scripts": {
    "new:command": "node ./src/commands/run.command.mjs new:command"
  }
}
```

3. **Ensure Target Workspaces** have the corresponding script defined

## Adding New Workspaces

When adding a new workspace to the monorepo:

1. **Create the workspace** with appropriate `package.json` scripts
2. **Update relevant command mappings** in `ci-cd.config.mjs`
3. **Test the integration** by running applicable commands

### **Workspace Integration Checklist:**

- âœ… Package has required scripts (lint:code:run, lint:types:run, etc.)
- âœ… Added to appropriate command mappings
- âœ… Dependencies properly configured
- âœ… Testing commands work correctly

## Customization Options

### **Command Execution Order**
Commands execute sequentially through workspace arrays. Modify array order to change execution sequence.

### **Selective Targeting**
Create specialized commands for specific workspace combinations:

```javascript
"lint:frontend:only": [
  "@windows98/app",
  "@windows98/design-system", 
  "@windows98/micro-frontends"
],
"test:core:only": [
  "@windows98/micro-services",
  "@windows98/toolkit"
]
```

### **Environment-Specific Commands**
Add environment-aware commands for different deployment targets:

```javascript
"build:development": ["@windows98/app"],
"build:production": ["@windows98/app"],
"build:staging": ["@windows98/app"]
```

## Configuration Best Practices

- **Keep Related Commands Together**: Group similar operations in the configuration
- **Use Descriptive Names**: Command names should clearly indicate their purpose
- **Minimize Workspace Overlap**: Avoid unnecessary command executions
- **Test New Configurations**: Verify new commands work across all target workspaces
- **Document Custom Commands**: Add comments for non-standard command purposes
